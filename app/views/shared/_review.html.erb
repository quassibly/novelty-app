<dialog id="comment">
  <div class="dialog">

      <textarea class="comment-title" size="5x6" placeholder="Comment Title"></textarea>
      <textarea class="comment_text" size="24x6" placeholder="What is your comment?"></textarea>
      <textarea class="suggested_change" size="24x6" placeholder="What would you suggest instead?"></textarea>
      <div class="modal-actions">
        <button id="cancel" type="reset" class="btn btn-secondary">Cancel</button>
        <button id="submit" class="btn btn-primary">Add comment</button>
      </div>
  </div>
</dialog>


<!-- <menu> -->
  <button id="add-comment" class="btn btn-secondary" onclick="wrapSelectedText();" value="Highlight"">Add Comment</button>
<!-- </menu> -->

  <script>

    let num = 0



    function wrapSelectedText() {

    var selection= window.getSelection().getRangeAt(0);
    var selectedText = selection.extractContents();
    var span = document.createElement("span");
    num = num + 1
    span.id = num
    span.class = "Highlight"
    span.style.backgroundColor = "yellow";
    span.appendChild(selectedText);
    selection.insertNode(span);
}

function saveComment() {
  let selected_location = window.getSelection()
  let selected_text = document.getElementById(`${num}`).innerText
  let comment_title = document.querySelector('.comment_title').innerText
  let comment_text = document.querySelector('.comment_text').value
  let suggested_change = document.querySelector('.suggested_change').value
  let novel = document.querySelector('.novel')
  const novel_id = novel.dataset.id

  fetch(`/reviews/${novel_id}`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    credentials: 'same-origin',
    body: JSON.stringify({
      "review": {
      comment_title: comment_title,
      comment_text: comment_text,
      selected_text: selected_text,
      suggested_change: suggested_change,
      novel_id: novel_id
      }
    })
  })
    const highlight_span = document.getElementById(`${num}`)
    console.log(highlight_span.innerHTML)
    highlight_span.insertAdjacentHTML('beforebegin', '<span class="suggested_change" style="display:none">${suggested_change}</span>')

};








    const commentButton = document.getElementById('add-comment');
    const dialog = document.getElementById('comment');
    const cancelButton = document.getElementById('cancel')
    const submit = document.getElementById('submit');

    commentButton.addEventListener('click', function() {
      dialog.showModal();
    });
    cancelButton.addEventListener('click', function() {
      dialog.close();
    });

    submit.addEventListener('click', saveComment)
    submit.addEventListener('click', function() {
      dialog.close();
    })




  </script>
