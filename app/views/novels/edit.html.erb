<div class="container">
  <%= render 'shared/sidebar' %>
  <div class="form-container">
    <%= simple_form_for @novel, :url => novel_path(@novel), :method => :patch do |f| %>

      <%= f.text_field(:title, class: "novel-title") %>
      <div class = "content"><%= f.text_area(:content, :size => "100x30", class: "novel") %></div>
      <%= submit_tag('Save Novel', class: "btn")%>

  <% end %>
  <div>
    <span class="wordcount"><%= @novel.novel_wordcount %></span> Words
  </div>
  <div>
    <span class="charcount"><%= @novel.content.length %></span> Characters
  </div>

    <!-- random sentence generator modal -->
    <%= render 'shared/random' %>
  </div>
   <div ></div>
</div>


<!--
Implement a counter method/timer method. when this method reaches either 500 characters or 5 minutes then runs a second method that does a fetch(post) method that sends a JSON file to the controller that reads the file then saves this to @novel.content
-->

<script>
  // function keyCount() {
  //   const text = document.querySelector('novel');
  //   let count = 0;
  //   text.addEventListener('keyUp', {
  //     count += 1;
  //     if (count === 100)
  //       saveNovel()
  //   });
  // };

  // function timer() {
  //   sleep(300)
  //   saveNovel()
  //   timer()
  // }

  // function saveNovel = (event) => {
  //   const content = document.querySelector('novel')
  //   fetch(`novel/#{@novel.id}`, {
  //     method: "Post",
  //     headers: {
  //       "Content-Type": "application/json"
  //     },
  //     body.JSON.stringify({event.currentTarget.value})
  //   })
  //   .then(response => response.json())
  // };
    const content = document.querySelector(".content");
  function wordCount(e) {
    if(e.keyCode == 32) {
      // preventDefault()
      let wordcount = document.querySelector(".wordcount").innerText;
      let num = Number(wordcount);
      num = num + 1;
      document.querySelector(".wordcount").innerText = num
    }
  };

  function charCount() {
    let charcount = document.querySelector(".charcount").innerText;
    let num = Number(charcount)
    num = num + 1;
    document.querySelector(".charcount").innerText = num
  };

  content.addEventListener('keyup', wordCount)
  content.addEventListener('keyup', charCount)

  // function keyCount() { -->
     // const text = document.querySelector('novel');
    // let count = 0;
    // text.addEventListener('keyUp', {
      // count += 1;
      // if (count === 100)
        saveNovel()
    // });
  };

  function timer() {
    sleep(300)
    saveNovel()
    timer()
  }

  function saveNovel = (event) => {
    const content = document.querySelector('novel')
    fetch(`novel/#{@novel.id}`, {
      method: "Post",
      headers: {
        "Content-Type": "application/json"
      },
      body.JSON.stringify({event.currentTarget.value})
    })
    .then(response => response.json())
  };
 </script>