<div class="edit-container">
  <%= render 'shared/sidebar' %>
  <div class="novel-form">
    <%= simple_form_for @novel, :url => novel_path(@novel), :method => :patch do |f| %>
      <%= f.text_field(:title, class: "novel-title") %>
      <div class="content"><%= f.text_area(:content, class: "novel") %></div>
      <div class="edit-actions">
          <%= submit_tag('Save Novel', class: "btn btn-primary")%>
      </div>
  <% end %>

  <div class="edit-helpers">
    <!-- random sentence generator modal -->
    <%= render 'shared/random' %>
    <div class="edit-counter">
        <div><span class="wordcount"><%= @novel.novel_wordcount %></span> words</div>
        <span class=".">Word Count Target: 1450</span>
        <span class = "target"></span>
    </div>
  </div>
  </div>



</div>


<!--
Implement a counter method/timer method. when this method reaches either 500 characters or 5 minutes then runs a second method that does a fetch(post) method that sends a JSON file to the controller that reads the file then saves this to @novel.content
-->

<script>
  let count = 0
  const content = document.querySelector(".content");



  function keyCount() {
      count = count + 1
      if(count % 100 == 0) {
        saveNovel()
      }
  };

  // function timer() {
  //   sleep(5)
  //   saveNovel()
  //   timer()
  // }

  function saveNovel() {

    const content1 = document.getElementById("novel_content").value
    console.log(content1)
    <% @novel.content %> = content1
    // fetch(`novel/${@novel.id}`, {
    //   method: "PATCH",
    //   headers: {
    //     "Content-Type": "application/json"
    //   },
    //   body.JSON.stringify({content1})
    // })
  };


  function wordCount(e) {
    if(e.keyCode == 32) {
      let wordcount = document.querySelector(".wordcount").innerText;
      let num = Number(wordcount);
      num = num + 1;
      document.querySelector(".wordcount").innerText = num
      // Implement logic to acquire daily goal and compare with words to inform of goal status
   //   if(num > 300) {
  //      document.querySelector(".target").innerText = "Goal Reached!"
  //    }

    }
  };

  function timer() {
    sleep(300)
    saveNovel()
    timer()
  }

  content.addEventListener('keyup', keyCount)
  content.addEventListener('keyup', wordCount)
 </script>
